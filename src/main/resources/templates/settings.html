<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head th:replace="~{fragments/head :: head('Settings', ~{::style-content})}">
    <th:block th:fragment="style-content">
        <link rel="stylesheet" th:href="@{/css/settings.css}">
        <style>
            .error-block {
                color: #ef4444;
                display: block;
                margin-top: 5px;
                font-size: 0.85rem;
                font-weight: 500;
            }
            .input-error {
                border-color: #ef4444 !important;
            }
        </style>
    </th:block>
</head>

<body>
<div class="dashboard-wrapper">

    <aside th:replace="~{fragments/layout :: sidebar('settings', ${currentUser})}"></aside>

    <main class="main-content settings-content">
        <header class="settings-header">
            <div class="header-content">
                <h1 class="page-title" th:text="#{settings.title}">Settings</h1>
                <p class="page-subtitle" th:text="#{settings.subtitle}">Manage your account and preferences</p>
            </div>
        </header>

        <div class="settings-sections">
            <div class="settings-card">
                <div class="card-header">
                    <div class="header-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21M16 7C16 9.20914 14.2091 11 12 11C9.79086 11 8 9.20914 8 7C8 4.79086 9.79086 3 12 3C14.2091 3 16 4.79086 16 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <h2 class="card-title" th:text="#{settings.profile.title}">Profile</h2>
                </div>
                <div class="card-body">
                    <form class="settings-form" th:action="@{/settings/changeInfo}" th:method="post" th:object="${changeProfileDto}">
                        <div class="form-group">
                            <label for="fullName" class="form-label" th:text="#{settings.profile.fullname}">Full Name</label>
                            <input type="text" id="fullName" th:field="*{fullName}" class="form-input" required
                                   th:classappend="${#fields.hasErrors('fullName')} ? 'input-error'">
                            <small th:if="${#fields.hasErrors('fullName')}" th:errors="*{fullName}" class="error-block"></small>
                        </div>

                        <div class="form-group">
                            <label for="email" class="form-label" th:text="#{settings.profile.email}">Email Address</label>
                            <input type="email" id="email" th:field="*{email}" class="form-input" required
                                   th:classappend="${#fields.hasErrors('email')} ? 'input-error'">
                            <small th:if="${#fields.hasErrors('email')}" th:errors="*{email}" class="error-block"></small>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn-primary" th:text="#{settings.profile.button}">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="settings-card">
                <div class="card-header">
                    <div class="header-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M19 11H5C3.89543 11 3 11.8954 3 13V20C3 21.1046 3.89543 22 5 22H19C20.1046 22 21 21.1046 21 20V13C21 11.8954 20.1046 11 19 11Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M7 11V7C7 5.67392 7.52678 4.40215 8.46447 3.46447C9.40215 2.52678 10.6739 2 12 2C13.3261 2 14.5979 2.52678 15.5355 3.46447C16.4732 4.40215 17 5.67392 17 7V11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <h2 class="card-title" th:text="#{settings.security.title}">Security</h2>
                </div>
                <div class="card-body">
                    <form class="settings-form" th:action="@{/settings/changeUserPassword}" th:method="post" th:object="${changeUserPasswordDto}">
                        <div class="form-group">
                            <label for="newPassword" class="form-label" th:text="#{settings.security.new_password}">New Password</label>
                            <input type="password" id="newPassword" th:field="*{password}" class="form-input" required
                                   th:classappend="${#fields.hasErrors('password')} ? 'input-error'">
                            <small class="error-block" th:if="${#fields.hasErrors('password')}" th:errors="*{password}"></small>
                        </div>

                        <div class="form-group">
                            <label for="confirmPassword" class="form-label" th:text="#{settings.security.confirm_password}">Confirm Password</label>
                            <input type="password" id="confirmPassword" th:field="*{confirmPassword}" class="form-input" required
                                   th:classappend="${#fields.hasErrors('confirmPassword') || #fields.hasGlobalErrors()} ? 'input-error'">
                            <small class="error-block" th:if="${#fields.hasErrors('confirmPassword')}" th:errors="*{confirmPassword}"></small>
                        </div>

                        <div th:if="${#fields.hasGlobalErrors()}">
                            <small class="error-block" th:each="err : ${#fields.globalErrors()}" th:text="${err}"></small>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn-primary" th:text="#{settings.security.button}">Update Password</button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="settings-card danger-zone">
                <div class="card-header danger-header">
                    <div class="header-icon danger-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 6H5H21M8 6V4C8 3.46957 10 2 10 2H14C14.5304 2 16 3.46957 16 4V6M19 6V20C19 22 17 22 17 22H7C5 22 5 20.5304 5 20V6H19Z"/>
                        </svg>
                    </div>
                    <h2 class="card-title danger-title" th:text="#{settings.danger.title}">Danger Zone</h2>
                </div>
                <div class="card-body">
                    <div class="danger-content">
                        <p class="danger-text">
                            <strong th:text="#{settings.danger.deactivate_label}">Deactivate Account:</strong>
                            <span th:text="#{settings.danger.deactivate_text}">Your data will be preserved but you will be logged out immediately.</span>
                        </p>
                        <form th:action="@{/settings}" th:method="delete">
                            <button type="submit" class="btn-danger" th:text="#{settings.danger.deactivate_button}"
                                    th:onclick="|return confirm('#{settings.danger.confirm_msg}')|">
                                Deactivate My Account
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<button th:replace="~{fragments/layout :: mobile-toggle}"></button>

<th:block th:replace="~{fragments/scripts :: common-scripts}"></th:block>
</body>
</html>